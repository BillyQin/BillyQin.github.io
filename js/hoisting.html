<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>变量提升 | BillyQin&#39;s Blog</title>
    <meta name="description" content="This is BillyQin Blog">
    
    
    <link rel="preload" href="/assets/css/0.styles.78f28ec0.css" as="style"><link rel="preload" href="/assets/js/app.cce4d29b.js" as="script"><link rel="preload" href="/assets/js/2.0660bc17.js" as="script"><link rel="preload" href="/assets/js/11.0b703968.js" as="script"><link rel="prefetch" href="/assets/js/10.7563b36e.js"><link rel="prefetch" href="/assets/js/12.a77f864c.js"><link rel="prefetch" href="/assets/js/13.c1ce1dea.js"><link rel="prefetch" href="/assets/js/14.3ba1a09b.js"><link rel="prefetch" href="/assets/js/3.6be1c7af.js"><link rel="prefetch" href="/assets/js/4.dd8fff0e.js"><link rel="prefetch" href="/assets/js/5.be4c36a3.js"><link rel="prefetch" href="/assets/js/6.34f7e2c7.js"><link rel="prefetch" href="/assets/js/7.b055b692.js"><link rel="prefetch" href="/assets/js/8.10c976b0.js"><link rel="prefetch" href="/assets/js/9.4b73b5eb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.78f28ec0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">BillyQin's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://github.com/BillyQin" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://github.com/BillyQin" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/js/promise.html" class="sidebar-link">手写Promise A+, 已通过官方872个测试用例</a></li><li><a href="/js/hoisting.html" class="active sidebar-link">变量提升</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/hoisting.html#什么是变量提升？" class="sidebar-link">什么是变量提升？</a></li><li class="sidebar-sub-header"><a href="/js/hoisting.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/js/transformation.html" class="sidebar-link">数据类型转换的4大核心规则</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="变量提升"><a href="#变量提升" class="header-anchor">#</a> 变量提升</h1> <h2 id="什么是变量提升？"><a href="#什么是变量提升？" class="header-anchor">#</a> 什么是变量提升？</h2> <p>在当前上下文中（全局/私有/块级），js代码自上而下执行之前，浏览器会提前处理一些事情。
浏览器会把当前上下文中所有带 <strong>var</strong> 和 <strong>function</strong> 关键字进行提前的声明或者定义</p> <blockquote><p>js中创建一个变量有六种方式：var let const class function import。其中只有var 和 function 才能触发变量提升。</p></blockquote> <ul><li>声明 declare:   var a;</li> <li>定义 defined:   a = 10;</li></ul> <h4 id="_1-带var的会提前声明"><a href="#_1-带var的会提前声明" class="header-anchor">#</a> 1. 带var的会提前声明</h4> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// =&gt; undefined</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// =&gt; 10</span>
</code></pre></div><h4 id="_2-带funtion的会提前声明且定义。"><a href="#_2-带funtion的会提前声明且定义。" class="header-anchor">#</a> 2. 带funtion的会提前声明且定义。</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 已经声明函数fn且定义。 =&gt; hello</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-函数表达式"><a href="#_3-函数表达式" class="header-anchor">#</a> 3. 函数表达式</h4> <p>然而在实际项目中，更建议使用函数表达式创建函数。这样在变量提升阶段只会声明fn，而不会定义。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; Uncaught TypeError: fn is not a function</span>
<span class="token keyword">var</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 代码自上而下执行 =&gt; ok</span>
</code></pre></div><h4 id="_4-与全局对象“映射”"><a href="#_4-与全局对象“映射”" class="header-anchor">#</a> 4. 与全局对象“映射”</h4> <p>带var 和 function 在全局上下文中声明的变量（全局变量）。会&quot;映射&quot;到全局对象（window/global）上，作为全局对象的一个属性。接下来代码执行的过程中，一个被改变，另一个也会跟着修改</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">)</span> <span class="token comment">// =&gt; 10</span>
window<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">12</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// =&gt; 12</span>

<span class="token comment">// let声明的变量不会“映射”到全局对象</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">100</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>b<span class="token punctuation">)</span> <span class="token comment">// =&gt; undefined</span>


<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token comment">// 私有上下文中 var 声明也不会&quot;映射&quot;到全局</span>
 <span class="token keyword">var</span> d <span class="token operator">=</span> <span class="token number">10</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>d<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; undefined</span>
</code></pre></div><h4 id="_5-块级作用域下的变量提升"><a href="#_5-块级作用域下的变量提升" class="header-anchor">#</a> 5. 块级作用域下的变量提升</h4> <p>在块级作用域下，无论条件是否成立，都会进行变量提升。但是function只会声明不会定义。</p> <blockquote><p>IE6-IE8中块级作用域下function也会声明且定义。由于兼容IE8已经成为过去时，仅了解即可</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">'AAA'</span> <span class="token keyword">in</span> window<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 变量提升，AAA已经被声明，但是未定义。所以此时window.AAA为undefined</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span>
  <span class="token keyword">function</span> <span class="token constant">AAA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">//  =&gt; undefined</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">AAA</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; undefined</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">BBB</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; function BBB() {console.log('hello')}</span>
<span class="token keyword">function</span> <span class="token constant">BBB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>浏览器会在执行代码之前，把当前上下文中所有带 <strong>var</strong> 和 <strong>function</strong> 关键字进行提前的声明或者定义。</p> <p>由于变量提升的存在，代码的最终运行结果可能会与我们设想的结果有偏差，引出奇怪的bug。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 由于变量提升的机制，这段代码最终打印undefined，而不是我们设想的1</span>
<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token number">10</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span> <span class="token comment">// =&gt; undefined</span>
<span class="token punctuation">}</span>
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>在实际项目中声明变量还是建议使用ES6中的 let/const，声明函数使用函数表达式。这样代码会更严谨一些，减少不必要的问题出现。</p> <h3 id="无关紧要的彩蛋"><a href="#无关紧要的彩蛋" class="header-anchor">#</a> 无关紧要的彩蛋</h3> <h5 id="匿名函数具名化"><a href="#匿名函数具名化" class="header-anchor">#</a> 匿名函数具名化</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token constant">AAA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 具名化该函数为AAA</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>在调试时，可以明确地在调用栈中看到该函数，如果不加这名称，也就是&quot;匿名函数表达式&quot;在调试时是看不到调用了什么的。这使得调试时多了一些便利</li> <li>可以递归调用自身，不需要用严格模式下不支持的arguments.callee</li></ul> <blockquote><p>总结：实际项目中具名化可加可不加，了解即可。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token constant">AAA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 可以递归调用自身，不需要用严格模式下不支持的arguments.callee</span>
    <span class="token constant">AAA</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment">// 函数外部不可用</span>
<span class="token constant">AAA</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> Uncaught ReferenceError<span class="token operator">:</span> ccc is not defined
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/js/promise.html" class="prev">手写Promise A+, 已通过官方872个测试用例</a></span> <span class="next"><a href="/js/transformation.html">数据类型转换的4大核心规则</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.cce4d29b.js" defer></script><script src="/assets/js/2.0660bc17.js" defer></script><script src="/assets/js/11.0b703968.js" defer></script>
  </body>
</html>
